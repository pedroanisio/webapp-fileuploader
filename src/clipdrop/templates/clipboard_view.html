{% extends "base.html" %}
{% from "macros.html" import page_header, section_header, empty_state, file_icon, button %}

{% block title %}{{ file.name if file else 'Not Found' }} - ClipDrop{% endblock %}

{% block content %}
{% if file %}
<!-- Page Header -->
<div class="page-header mb-4">
    <a href="{{ url_for('shared_clipboard') }}" class="btn btn-outline-primary btn-sm mb-3">
        <i class="fas fa-arrow-left" aria-hidden="true"></i> Back to Clipboard
    </a>
    <h1 class="page-title">
        <i class="fas {{ file_icon(file.extension) }}" aria-hidden="true"></i>
        Shared Content
    </h1>
    <p class="page-subtitle">
        <i class="fas fa-clock" aria-hidden="true"></i> {{ file.creation_time.strftime('%Y-%m-%d %H:%M:%S') }}
        &nbsp;&middot;&nbsp;
        <i class="fas fa-weight" aria-hidden="true"></i> {{ file.size_human }}
    </p>
</div>

<!-- Content Card -->
<div class="page-card">
    <div class="section-header">
        <h2 class="section-title"><i class="fas fa-eye" aria-hidden="true"></i> Content</h2>
        <div class="action-buttons">
            {% if is_text %}
            <button id="copy-btn" class="btn btn-primary btn-sm" aria-label="Copy content to clipboard">
                <i class="fas fa-copy" aria-hidden="true"></i> Copy
            </button>
            {% endif %}
            <button id="share-btn" class="btn btn-success btn-sm" data-url="{{ request.url }}" aria-label="Copy shareable link">
                <i class="fas fa-link" aria-hidden="true"></i> Link
            </button>
            <a href="{{ url_for('clipboard_file_raw', filename=file.name) }}" class="btn btn-info btn-sm" download aria-label="Download file">
                <i class="fas fa-download" aria-hidden="true"></i> Download
            </a>
        </div>
    </div>

    {% if is_text %}
    <div class="content-text" id="content-text">{{ file.content | e }}</div>
    {% else %}
    <div class="image-container">
        <img src="{{ url_for('clipboard_file_raw', filename=file.name) }}" class="content-image" alt="Shared Image: {{ file.name }}">
    </div>
    {% endif %}
</div>
{% else %}
<!-- Not Found State -->
<div class="page-card">
    {{ empty_state(
        'fa-exclamation-circle text-danger',
        'Content Not Found',
        'This clipboard item may have expired or been deleted.',
        url_for('shared_clipboard'),
        'Go to Shared Clipboard',
        'fa-arrow-left'
    ) }}
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/clipboard.js') }}"></script>
<script>
    const copyBtn = document.getElementById('copy-btn');
    if (copyBtn) {
        copyBtn.addEventListener('click', async () => {
            const content = document.getElementById('content-text').textContent;
            try {
                await navigator.clipboard.writeText(content);
                showToast('Copied to clipboard!', 'success');

                copyBtn.innerHTML = '<i class="fas fa-check" aria-hidden="true"></i> Copied!';
                copyBtn.classList.remove('btn-primary');
                copyBtn.classList.add('btn-success');

                setTimeout(() => {
                    copyBtn.innerHTML = '<i class="fas fa-copy" aria-hidden="true"></i> Copy';
                    copyBtn.classList.remove('btn-success');
                    copyBtn.classList.add('btn-primary');
                }, 2000);
            } catch (err) {
                showToast('Failed to copy', 'error');
            }
        });
    }

    const shareBtn = document.getElementById('share-btn');
    if (shareBtn) {
        shareBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(shareBtn.getAttribute('data-url'));
                showToast('Link copied!', 'success');

                shareBtn.innerHTML = '<i class="fas fa-check" aria-hidden="true"></i> Copied!';

                setTimeout(() => {
                    shareBtn.innerHTML = '<i class="fas fa-link" aria-hidden="true"></i> Link';
                }, 2000);
            } catch (err) {
                showToast('Failed to copy link', 'error');
            }
        });
    }

    const contentText = document.getElementById('content-text');
    if (contentText) {
        contentText.addEventListener('dblclick', () => {
            const range = document.createRange();
            range.selectNodeContents(contentText);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
        });
    }
</script>
{% endblock %}
